<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ page.title }} - {{ site.title }}</title>
  <link rel="stylesheet" href="{{ '/assets/css/style.css' | relative_url }}">
</head>
<body>
  <header>
    <div class="container header-container">
      <h1><a href="{{ '/' | relative_url }}">{{ site.title }}</a></h1>
      <nav>
        <button class="sidebar-toggle" id="sidebarToggle" aria-label="Toggle sidebar">
          <span class="hamburger-icon"></span>
        </button>
        {% for link in site.nav_links %}
        <a href="{{ link.url | relative_url }}">{{ link.title }}</a>
        {% endfor %}
      </nav>
      {% include language-selector.html %}
    </div>
  </header>

  <div class="docs-layout" id="docsLayout">
    <aside class="docs-sidebar" id="docsSidebar">
      <nav class="docs-nav">
        <h3>{{ page.section_title | default: "Documentation" }}</h3>

        {% if page.navigation %}
          {% assign nav_items = site.data.navigation[page.navigation] %}
          {% for item in nav_items %}
            <div class="nav-section">
              {% if item.title %}
                {% assign is_active_section = false %}
                {% for link in item.links %}
                  {% if page.url == link.url %}
                    {% assign is_active_section = true %}
                  {% endif %}
                {% endfor %}
                <details {% if is_active_section %}open{% endif %}>
                  <summary>{{ item.title }}</summary>
                  <ul>
                    {% for link in item.links %}
                      <li>
                        <a href="{{ link.url }}" {% if page.url == link.url %}class="active"{% endif %}>
                          {{ link.title }}
                        </a>
                        {% if link.sublinks %}
                          <ul class="sublinks">
                            {% for sublink in link.sublinks %}
                              <li>
                                <a href="{{ sublink.url }}">{{ sublink.title }}</a>
                              </li>
                            {% endfor %}
                          </ul>
                        {% endif %}
                      </li>
                    {% endfor %}
                  </ul>
                </details>
              {% else %}
                <ul>
                  {% for link in item.links %}
                    <li>
                      <a href="{{ link.url }}" {% if page.url == link.url %}class="active"{% endif %}>
                        {{ link.title }}
                      </a>
                    </li>
                  {% endfor %}
                </ul>
              {% endif %}
            </div>
          {% endfor %}
        {% endif %}
      </nav>
    </aside>

    <main class="docs-content">
      <article class="page">
        <h1>{{ page.title }}</h1>
        <div class="content">
          {{ content }}
        </div>
      </article>
    </main>
  </div>

  <footer>
    <div class="container">
      <p>&copy; {{ 'now' | date: "%Y" }} ZConverter. All rights reserved.</p>
    </div>
  </footer>

  <script>
  (function() {
    function openDetailsById(hash) {
      if (!hash) return;
      var target = document.querySelector(hash);
      if (target && target.tagName === 'DETAILS') {
        target.open = true;
        target.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
    }

    // 페이지 로드 시 URL 해시가 있으면 해당 details 열기
    document.addEventListener('DOMContentLoaded', function() {
      openDetailsById(window.location.hash);
    });

    // 페이지 내 앵커 클릭 시 details 열기
    document.addEventListener('click', function(e) {
      var link = e.target.closest('a[href^="#"]');
      if (link) {
        var targetId = link.getAttribute('href');
        openDetailsById(targetId);
      }
    });

    // 사이드바 토글 기능
    var sidebar = document.getElementById('docsSidebar');
    var toggleBtn = document.getElementById('sidebarToggle');
    var docsLayout = document.querySelector('.docs-layout');
    var STORAGE_KEY = 'zdm-sidebar-collapsed';

    function setSidebarState(collapsed) {
      if (collapsed) {
        docsLayout.classList.add('sidebar-collapsed');
        toggleBtn.classList.remove('is-active');
        toggleBtn.setAttribute('aria-expanded', 'false');
      } else {
        docsLayout.classList.remove('sidebar-collapsed');
        toggleBtn.classList.add('is-active');
        toggleBtn.setAttribute('aria-expanded', 'true');
      }
      localStorage.setItem(STORAGE_KEY, collapsed ? 'true' : 'false');
    }

    // 초기 상태 복원
    var savedState = localStorage.getItem(STORAGE_KEY);
    if (savedState === 'true') {
      setSidebarState(true);
    } else {
      toggleBtn.classList.add('is-active');
    }

    // 토글 버튼 클릭 이벤트
    toggleBtn.addEventListener('click', function() {
      var isCollapsed = docsLayout.classList.contains('sidebar-collapsed');
      setSidebarState(!isCollapsed);
    });
  })();
  </script>
</body>
</html>
